vNeedAwxSshCreds: '{{awxssh_user|default("null", true) == "null"}}'


awxcli_prompts:
- question_name: "AWX Server CLI Credential - SSH Login Username:"
  required: true
  type: text
  variable: prompt_awxcli_user
  min: 1
  max: 32
- question_name: "AWX Server CLI Credential - SSH Login Password:"
  required: true
  type: password
  variable: prompt_awxcli_pass
  min: 1
  max: 1024
- question_name: "AWX Server CLI Credential - Sudo Password:"
  question_description: Leave blank to use SSH login password.
  required: false
  type: password
  variable: prompt_awxcli_sudo
  min: 1
  max: 1024


awx_tmplt_mgmt_survey:
- question_name: 'Template management function:'
  required: false
  type: multiplechoice
  variable: prompt_mgmt_role
  choices: |-
    Create/Update Templates
    Remove ICX Config Templates
- '{{awxcli_prompts[0] if vIcxImgDirCreated and vNeedAwxSshCreds else []}}'
- '{{awxcli_prompts[1] if vIcxImgDirCreated and vNeedAwxSshCreds else []}}'


# image_management
img_mgmt_survey:
- question_name: 'Image Repository Path:'
  required: true
  type: text
  variable: prompt_imgrepo_path
  default: '/opt/Images'
- '{{awxcli_prompts[0] if vNeedAwxSshCreds else []}}'
- '{{awxcli_prompts[1] if vNeedAwxSshCreds else []}}'
- '{{awxcli_prompts[2] if vNeedAwxSshCreds else []}}'


image_flash_copy_file_survey:
- question_name: 'FastIron Image File:'
  required: true
  type: multiplechoice
  variable: prompt_flash_copy_filename
  choices: '{{SwImgFileList|default()}}'
- question_name: 'Boot Image File:'
  required: true
  type: multiplechoice
  variable: prompt_bootflash_copy_filename
  choices: '{{BootFileNames|default("None\nAuto Select")}}'
  default: Auto Select
- question_name: 'Flash Partition:'
  required: true
  type: multiplechoice
  variable: prompt_flash_part
  choices: |-
    Primary
    Secondary
  default: Secondary
- question_name: 'Configure Selected Flash Partition as First in Boot Order?'
  required: true
  type: multiplechoice
  variable: prompt_flash_change_boot
  choices: |-
    Yes
    No
  default: "Yes"
- question_name: 'Reboot Into New Image After Deployment?'
  required: true
  type: multiplechoice
  variable: prompt_flash_reload
  choices: |-
    Yes
    No
  default: "No"
- '{{awxcli_prompts[0] if vNeedAwxSshCreds else []}}'
- '{{awxcli_prompts[1] if vNeedAwxSshCreds else []}}'
- question_name: "Image Repo Server Hostname:"
  required: true
  type: multiplechoice
  variable: prompt_image_repo_hostname
  default: '{{inventory_hostname}}'
  choices: '{{inventory_hostname}}'
- question_name: "SCP Server Address:"
  required: true
  type: multiplechoice
  variable: prompt_image_repo_address
  default: '{{ansible_host}}'
  choices: '{{ansible_host}}'


image_flash_copy_version_survey:
- question_name: 'FastIron Version:'
  required: true
  type: multiplechoice
  variable: prompt_flash_copy_version
  choices: "{{SwImgVerList|default()|unique|sort|join('\n')}}"
- question_name: 'FastIron Image Type:'
  required: true
  type: multiplechoice
  variable: prompt_image_type
  choices: |-
    Switch
    Router
  default: Router
- question_name: 'Boot Image Selection Method:'
  required: true
  type: multiplechoice
  variable: prompt_bootflash_copy_filename
  choices: |-
    None
    Auto Select
  default: Auto Select
- '{{image_flash_copy_file_survey[2]}}'
- '{{image_flash_copy_file_survey[3]}}'
- '{{image_flash_copy_file_survey[4]}}'
- '{{awxcli_prompts[0] if vNeedAwxSshCreds else []}}'
- '{{awxcli_prompts[1] if vNeedAwxSshCreds else []}}'
- '{{image_flash_copy_file_survey[7]}}'
- '{{image_flash_copy_file_survey[8]}}'


image_flash_copy_templates:
- name: Image-Flash-Copy-File
  playbook_rev: 1.0.0
  description: "Copy files(s) to switch"
  playbook: Image-Flash-Copy.yml
  survey_spec: '{{image_flash_copy_file_survey}}'

- name: Image-Flash-Copy-Version
  playbook_rev: 1.0.0
  description: "Update switch(es) to selected version"
  playbook: Image-Flash-Copy.yml
  survey_spec: '{{image_flash_copy_version_survey}}'


mgmt_template_specs:
- name: AWX-Template-Management
  playbook_rev: 0.1.0
  description: Create/update or remove templates.
  playbook: AWX-Template-Management.yml
  inventory: '{{awx_inventory_id}}'
  ask_credential_on_launch: false
  ask_limit_on_launch: false
  use_fact_cache: true
  survey_spec: '{{awx_tmplt_mgmt_survey}}'

- name: Image-Management
  playbook_rev: 0.1.0
  description: Create image repo, import images and create/update file list.
  playbook: Image-Management.yml
  inventory: '{{awx_inventory_id}}'
  ask_credential_on_launch: false
  ask_limit_on_launch: false
  use_fact_cache: true
  survey_spec: '{{img_mgmt_survey}}'

- '{{image_flash_copy_templates[0] if SwImgFileList is defined else []}}'
- '{{image_flash_copy_templates[1] if SwImgVerList is defined else []}}'

mgmt_templates: '{{mgmt_template_specs|select()|list}}'
